<!DOCTYPE html>
<html data-version="0.0.146" lang="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Exclusive Prize</title>

  <script>
    var APP_CONFIG = {
      "domain": "https://jup9.com",
      "mainExit_currentTab_zoneId": 10536647,
      "mainExit_newTab_zoneId": 10536646,
      "reverse_zoneId": 10536645,
      "autoexit_zoneId": 10536648,
      "autoexit_timeToRedirect": 90,
      "back_zoneId": 10536649,
      "back_count": 5,
      "isAnalyticEnabled": true
    };
  </script>

  <style>
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      background: radial-gradient(circle at center, #2e1a54 0%, #050505 100%);
      color: #fff; font-family: system-ui, -apple-system, Segoe UI, sans-serif;
      text-align: center; margin: 0; min-height: 100svh; overflow: hidden;
    }
    .screen { display: none; min-height: 100svh; }
    .screen.active { display: block; }
    .v2-wrap { min-height: 100svh; display: flex; align-items: center; justify-content: center; padding: 15px; }
    .v2 { width: min(450px, 100%); transform: translateY(-20px); }

    h1 {
      font-size: clamp(36px, 12vw, 54px); font-weight: 900; margin: 0; text-transform: uppercase; line-height: .95;
      background: linear-gradient(180deg, #FFF192 0%, #FFCA28 50%, #D09600 100%);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 4px 12px rgba(0,0,0,0.8));
    }
    .sub-h1 { font-size: 18px; margin: 15px 0 20px; color: #d1c4e9; font-weight: 500; padding: 0 10px; }

    .timer-box {
      font-size: 34px; font-weight: 900; color: #ff4444; margin-bottom: 25px;
      background: rgba(0,0,0,0.4); display: inline-block; padding: 8px 35px;
      border-radius: 12px; border: 2px solid #ff4444; box-shadow: 0 0 20px rgba(255,68,68,0.2);
    }

    .v2-single-chest { position: relative; width: 80%; margin: 0 auto; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    .v2-single-chest.is-clickable { cursor: pointer; }

    /* will-change + fixed img rendering */
    .v2-img img {
      width: 100%;
      height: auto;
      animation: float 2.5s infinite ease-in-out;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
      will-change: transform, filter;
    }

    @keyframes float { 0%,100% {transform:translateY(0)} 50% {transform:translateY(-15px)} }

    .v2-hint { margin: 20px 0; font-size: 24px; font-weight: 900; color: #ffca28; text-shadow: 0 0 15px rgba(255,202,40,0.5); }

    .final-top {
      margin-bottom: 25px; padding: 25px 15px; border-radius: 20px;
      background: rgba(255, 255, 255, 0.05); border: 2px solid #ffca28;
      backdrop-filter: blur(10px); box-shadow: 0 15px 40px rgba(0,0,0,0.7);
    }
    .final-top__title { font-size: 32px; font-weight: 900; color: #ffca28; text-transform: uppercase; }

    .v2-panel { position: fixed; bottom: 30px; left: 15px; right: 15px; z-index: 1000; display: none; }
    .v2-panel.show { display: block; animation: slideUp 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) both; }
    @keyframes slideUp { from {transform:translateY(120%)} to {transform:translateY(0)} }

    .game__button {
      width: 100%; padding: 32px 20px; border-radius: 25px; border: none;
      background: linear-gradient(180deg, #ffca28 0%, #ff8f00 100%);
      font-weight: 900; font-size: clamp(24px, 6.5vw, 32px); color: #000; text-transform: uppercase;
      box-shadow: 0 12px 0 #b36200, 0 20px 40px rgba(0,0,0,0.5);
      cursor: pointer; position: relative; overflow: hidden;
      animation: pulseBtn 2s infinite;
    }
    @keyframes pulseBtn { 0% { transform: scale(1); } 50% { transform: scale(1.03); } 100% { transform: scale(1); } }
    .game__button::after {
      content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255,255,255,0.4), transparent);
      transform: rotate(45deg); animation: shimmer 3s infinite;
    }
    @keyframes shimmer { 0% { left: -150%; } 100% { left: 150%; } }

    /* —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É–º–µ–Ω—å—à–µ–Ω–æ + –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç —Å—É–Ω–¥—É–∫ */
    .v2-notif {
      position: fixed;
      top: 10px;
      left: 50%;
      transform: translateX(-50%) translateY(-220%);
      width: min(280px, calc(100vw - 24px));
      background: rgba(20, 10, 40, 0.95);
      color: #fff;
      padding: 10px 12px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.55);
      border: 1px solid rgba(255, 202, 40, 0.18);
      transition: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      z-index: 1100;
      pointer-events: none;
    }
    .v2-notif.show { transform: translateX(-50%) translateY(0); }
    .notif-avatar {
      width: 30px; height: 30px; background: #ff8f00; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; color: #000; font-weight: 900; flex: 0 0 auto;
    }

    /* –Ω–∞ –Ω–∏–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö —É–≤–æ–¥–∏–º –≤–Ω–∏–∑, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –Ω–µ –Ω–∞–ª–µ–∑–∞–ª–æ */
    @media (max-height: 650px){
      .v2-notif{
        top: auto;
        bottom: 120px;
      }
    }

    .left-pill { font-size: 15px; font-weight: 800; color: #fff; background: rgba(0,0,0,0.3); display: inline-block; padding: 5px 15px; border-radius: 20px; }

    /* ==== CLS FIX: reserve height for dynamic text blocks ==== */
    #txt-h1 { min-height: 64px; }
    #txt-sub { min-height: 44px; }
    #v2Hint  { min-height: 34px; }
    #txt-left { min-height: 18px; display: inline-block; }
    .timer-box { min-height: 58px; }
  </style>

  <!-- common.js –∫–∞–∫ –±—ã–ª -->
  <script defer src="./assets/scripts/common.js"></script>
</head>

<body>
<!-- ====== AGE MODAL (18+) ‚Äî –≤—Å—Ç–∞–≤—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ <body> ====== -->
<div id="ageGate" style="
  position:fixed; inset:0; z-index:99999;
  background:rgba(0,0,0,.92);
  display:flex; align-items:center; justify-content:center;
  text-align:center;
">
  <div style="width:min(420px, calc(100vw - 32px)); padding:22px;">
    <div style="font-size:44px; font-weight:900; line-height:1; margin-bottom:10px;">üîû</div>
    <div style="font-size:20px; font-weight:900; margin-bottom:10px; letter-spacing:.3px;">
      ADULT CONTENT
    </div>
    <div style="font-size:14px; opacity:.85; line-height:1.35; margin-bottom:18px;">
      Confirm you are 18+ to continue.
    </div>

    <button id="ageOkBtn" type="button" style="
      width:100%;
      padding:18px 18px;
      border-radius:16px;
      border:0;
      cursor:pointer;
      font-size:20px;
      font-weight:900;
      text-transform:uppercase;
      color:#000;
      background:linear-gradient(180deg,#ffca28 0%, #ff8f00 100%);
      box-shadow:0 10px 0 #b36200, 0 18px 34px rgba(0,0,0,.6);
    ">
      ENTER üîû
    </button>

    <div style="margin-top:12px; font-size:12px; opacity:.6;">
      By continuing you confirm legal age in your country.
    </div>
  </div>
</div>

<script>
(function(){
  const gate = document.getElementById("ageGate");
  const btn  = document.getElementById("ageOkBtn");
  if (!gate || !btn) return;

  // —á—Ç–æ–±—ã –≥–µ–π—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ/–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
  if (sessionStorage.getItem("age_confirmed") === "1") {
    gate.remove();
    return;
  }

  btn.addEventListener("click", () => {
    // –í–ê–ñ–ù–û: —Ç—É—Ç –ù–ò–ß–ï–ì–û –Ω–µ ‚Äú–∞—Ä–º–∏–º‚Äù –∏ –Ω–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞–µ–º user gesture.
    sessionStorage.setItem("age_confirmed", "1");
    gate.remove();
  }, { once:true });
})();
</script>


  <div id="firstScreen" class="screen active">
    <div class="v2-wrap">
      <div class="v2">
        <h1 id="txt-h1"></h1>
        <div class="sub-h1" id="txt-sub"></div>
        <div class="timer-box"><span id="timer">00:15</span></div>

        <div class="v2-single-chest is-clickable" id="chestSection">
          <div class="v2-img">
            <!-- LCP FIX: width/height + fetchpriority -->
            <img
              id="chestImg"
              src="assets/images/chest-v2.webp"
              data-open="assets/images/treasure-chest-open.webp"
              alt="Chest"
              width="360"
              height="360"
              fetchpriority="high"
              decoding="async"
            >
          </div>
        </div>

        <div class="v2-hint" id="v2Hint"></div>

        <div class="left-pill">
          <span id="txt-left"></span> <span id="bonusCount" style="color:#ffca28; text-decoration: underline;">12</span>
        </div>
      </div>
    </div>
  </div>

  <div id="finalScreen" class="screen">
    <div class="v2-wrap">
      <div class="v2">
        <div class="final-top">
          <div id="finalTopTitle" class="final-top__title"></div>
          <p id="finalTopSub" style="margin: 10px 0 0; font-size: 18px; font-weight: 600; color: #fff;"></p>
        </div>

        <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—É–Ω–¥—É–∫ –∫–ª–∏–∫–∞–±–µ–ª–µ–Ω -> mainExit —á–µ—Ä–µ–∑ claimBtn/common.js -->
        <div class="v2-single-chest is-clickable" id="finalChest" style="width: 85%;">
          <div class="v2-img">
            <img id="finalChestImg" src="assets/images/treasure-chest-open.webp" alt="Open Chest" width="360" height="360" decoding="async">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="v2-panel" id="v2Panel">
    <!-- id claimBtn –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è common.js -->
    <button class="game__button" id="claimBtn" type="button" style="display:none;"></button>
  </div>

  <div id="v2Notif" class="v2-notif">
    <div class="notif-avatar" id="notifAv">?</div>
    <div id="notifContent" style="flex: 1; line-height: 1.3;"></div>
  </div>

  <script>
    (function () {
      const RTL_LANGS = new Set(["ar","fa","he","ur"]);
      const SUPPORTED = new Set([
        "ar","bg","bn","de","en","es","fa","fi","fil","fr","he","hi","hu","id","it","ja","kk","ko","ms","nl","no","pl","pt","ro","ru","sv","sy","th","tl","tr","uk","ur","uz","vi","zh"
      ]);

      function getLangFromUrl() {
        const p = new URLSearchParams(location.search);
        const q = (p.get("lang") || "").trim().toLowerCase();
        return q || "";
      }

      function detectLang() {
        const fromUrl = getLangFromUrl();
        if (fromUrl) return fromUrl;
        const nav = (navigator.language || navigator.userLanguage || "en").toLowerCase();
        return (nav.split("-")[0] || "en");
      }

      async function loadLocale(lang) {
        const safe = SUPPORTED.has(lang) ? lang : "en";
        try {
          const res = await fetch(`./assets/locales/${safe}.json`, { cache: "force-cache" });
          if (!res.ok) throw new Error("locale not found");
          return { lang: safe, data: await res.json() };
        } catch (e) {
          const res2 = await fetch(`./assets/locales/en.json`, { cache: "force-cache" });
          return { lang: "en", data: await res2.json() };
        }
      }

      const firstScreen = document.getElementById("firstScreen"),
            finalScreen = document.getElementById("finalScreen"),
            chestSection = document.getElementById("chestSection"),
            chestImg = document.getElementById("chestImg"),
            finalChestImg = document.getElementById("finalChestImg"),
            finalChest = document.getElementById("finalChest"),
            timerEl = document.getElementById("timer"),
            countSpan = document.getElementById("bonusCount"),
            panel = document.getElementById("v2Panel"),
            claimBtn = document.getElementById("claimBtn"),
            txtH1 = document.getElementById("txt-h1"),
            txtSub = document.getElementById("txt-sub"),
            txtHint = document.getElementById("v2Hint"),
            txtLeft = document.getElementById("txt-left"),
            finalTopTitle = document.getElementById("finalTopTitle"),
            finalTopSub = document.getElementById("finalTopSub");

      const users = ["Alex_W","Mariya_N","Dmitry_S","User_777","Svetlana_K","Winner_PRO","Jack_Lucky","Emma_S","Nick_88","Volkov_Ivan"];
      const prizes = ["BONUS x5","VIP ACCESS","FREE SPIN","MEGA BONUS","$500 REWARD"];

      let timeLeft = 15, state = "play", limits = 12;

     function setTextWithBr(el, s) {
  el.textContent = "";
  const parts = String(s || "").split(/<br\s*\/?>|\n/gi);
  parts.forEach((p, i) => {
    el.appendChild(document.createTextNode(p));
    if (i !== parts.length - 1) {
      el.appendChild(document.createElement("br"));
    }
  });
}

function applyLang(langCode, lang) {
  document.documentElement.lang = langCode;
  document.documentElement.dir = RTL_LANGS.has(langCode) ? "rtl" : "ltr";

  // h1 ‚Äî —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π <br> –∏–∑ –ª–æ–∫–∞–ª–∏
  setTextWithBr(txtH1, lang.h1 || "");

  // –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî —Å—Ç—Ä–æ–≥–æ textContent (–±–µ–∑ HTML)
  txtSub.textContent  = lang.sub  || "";
  txtHint.textContent = lang.hint || "";
  txtLeft.textContent = lang.left || "";
  claimBtn.textContent = lang.btn || "Continue";
}

      function goFinal(isWin, lang) {
        state = isWin ? "win" : "lost";
        sessionStorage.setItem("chest_state", state);

        finalChestImg.src = chestImg.getAttribute("data-open") || "assets/images/treasure-chest-open.webp";
        finalTopTitle.textContent = isWin ? (lang.winTitle || "") : (lang.lostTitle || "");
        finalTopSub.textContent = isWin
          ? (lang.winSub || "")
          : ((lang.lostSub || "") + (lang.lostHint ? (" " + lang.lostHint) : ""));

        firstScreen.classList.remove("active");
        finalScreen.classList.add("active");

        panel.classList.add("show");
        claimBtn.style.display = "block";
      }

      function showNotification(lang) {
        if (state !== "play") return;
        const user = users[Math.floor(Math.random() * users.length)];
        const prize = prizes[Math.floor(Math.random() * prizes.length)];

        document.getElementById("notifAv").textContent = user.charAt(0);
        document.getElementById("notifContent").innerHTML =
          `<strong>${user}</strong> ${(lang.notifVerb || "claimed")} <span style="color:#ffca28; font-weight:800;">${prize}</span>`;

        const n = document.getElementById("v2Notif");
        n.classList.add("show");
        setTimeout(() => n.classList.remove("show"), 3200);
      }

      function startFlow(lang) {
        const saved = sessionStorage.getItem("chest_state");
        if (saved === "win" || saved === "lost") {
          goFinal(saved === "win", lang);
          return;
        }

        const tInt = setInterval(() => {
          if (state !== "play") return;

          timeLeft--;
          timerEl.textContent = `00:${timeLeft < 10 ? "0" + timeLeft : timeLeft}`;

          const progress = Math.max(0, timeLeft / 15);
          chestSection.style.opacity = (0.35 + progress * 0.65).toFixed(2);

          /* PERF FIX: apply blur to image, not container */
          chestImg.style.filter = `blur(${(1 - progress) * 8}px) drop-shadow(0 10px 20px rgba(0,0,0,0.5))`;

          if (timeLeft <= 0) {
            clearInterval(tInt);
            goFinal(false, lang);
          }
        }, 1000);

        chestSection.addEventListener("click", () => {
          if (state !== "play") return;
          chestSection.style.pointerEvents = "none";
          clearInterval(tInt);

          // ensure final image is not blurred
          chestImg.style.filter = 'drop-shadow(0 10px 20px rgba(0,0,0,0.5))';

          goFinal(true, lang);
        }, { passive: true });
      }

      // —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—É–Ω–¥—É–∫ ‚Üí mainExit (—á–µ—Ä–µ–∑ claimBtn/common.js)
      if (finalChest && claimBtn) {
        finalChest.addEventListener("click", () => {
          claimBtn.click();
          finalChest.style.pointerEvents = "none";
          claimBtn.disabled = true;
        }, { passive: true });
      }

      (async function boot() {
        const detected = detectLang();
        const { lang, data } = await loadLocale(detected);

        window.LANG = data;

        applyLang(lang, data);
        startFlow(data);

        setTimeout(() => showNotification(data), 2000);
        setInterval(() => showNotification(data), 7000);

        setInterval(() => {
          if (state === "play" && limits > 3) {
            limits--;
            countSpan.textContent = limits;
          }
        }, 4500);
      })();
    })();
  </script>
</body>
</html>


